<!-- Code with chat interface and cad output
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>
        AI Assistant CATIA Output
    </title>
    <script src="https://cdn.tailwindcss.com">
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
</head>

<body class="bg-[#fdfdf8] text-[#0f3c4b] font-sans">
    <div class="flex flex-col md:flex-row h-screen">

        <div class="flex flex-col w-[40%] border-r border-[#e5e7eb]">
            <header class="flex items-center justify-between px-6 py-4 border-b border-[#e5e7eb]">
                <h1 class="text-2xl font-semibold">
                    AI Assistant
                </h1>
                <button
                    class="text-[#0f3c4b] text-sm border border-[#d1d5db] rounded-md px-3 py-1 hover:bg-[#f3f4f6] transition"
                    type="button" onclick="returnHome()">
                    ← Back to Home
                </button>
            </header>
            <main class="flex-1 overflow-y-auto px-6 py-4 space-y-6">
           
                <div class="flex space-x-4 max-w-xl">
                    <div class="flex-shrink-0">
                        <img alt="Robot assistant icon with pink and blue colors" class="rounded-full" height="32"
                            src="https://storage.googleapis.com/a1aa/image/274f13c7-ae6c-431b-7bfd-63c436fc4bef.jpg"
                            width="32" />
                    </div>
                    <div class="bg-[#e9e8e3] rounded-xl p-6 text-[#0f3c4b] text-sm leading-relaxed"
                        style="max-width: 400px;">
                        Hello! I'm your CATIA AI assistant. I can help you with CAD operations like generating bounding
                        boxes, measuring parts, and analyzing your models.
                    </div>
                </div>
     
                <div class="flex justify-end max-w-xl">
                    <div class="bg-[#19707a] text-white rounded-xl flex items-center justify-center w-14 h-36 text-center text-sm font-normal"
                        style="writing-mode: vertical-rl; text-orientation: mixed;">
                        d
                    </div>
                    <div class="flex-shrink-0 ml-3">
                        <img alt="User avatar icon purple silhouette on teal background" class="rounded-full"
                            height="32"
                            src="https://storage.googleapis.com/a1aa/image/759f54fa-e944-4d63-2afc-58cf0ca0a33b.jpg"
                            width="32" />
                    </div>
                </div>
       
                <div class="flex space-x-4 max-w-xl">
                    <div class="flex-shrink-0">
                        <img alt="Robot assistant icon with pink and blue colors" class="rounded-full" height="32"
                            src="https://storage.googleapis.com/a1aa/image/274f13c7-ae6c-431b-7bfd-63c436fc4bef.jpg"
                            width="32" />
                    </div>
                    <div class="bg-[#e9e8e3] rounded-xl p-6 text-[#0f3c4b] text-sm leading-relaxed"
                        style="max-width: 400px;">
                        I'd be happy to help! However, I need you to first upload a .CATPart file to work with. Please
                        go back to the homepage and upload your CAD file.
                    </div>
                </div>
            </main>
            <form class="flex items-center border-t border-[#e5e7eb] px-6 py-4">
                <input
                    class="flex-1 border border-[#d1d5db] rounded-lg px-4 py-3 text-[#4b5563] text-sm placeholder-[#6b7280] focus:outline-none focus:ring-2 focus:ring-[#19707a]"
                    placeholder="Ask me about your CAD model..." type="text" />
                <button
                    class="ml-4 bg-[#19707a] text-white rounded-lg px-6 py-3 text-sm font-medium hover:bg-[#145a63] transition"
                    type="submit">
                    Send
                </button>
            </form>
        </div>

        <div class="flex flex-col w-[60%]">
            <header class="flex items-center justify-between px-6 py-4 border-b border-[#e5e7eb]">
                <h2 class="text-2xl font-semibold">
                    CATIA Output
                </h2>
                <div class="flex space-x-3">
                    <button
                        class="flex items-center space-x-2 border border-[#d1d5db] rounded-md px-3 py-1 text-sm text-[#374151] hover:bg-[#f3f4f6] transition"
                        type="button">
                        <i class="fas fa-camera">
                        </i>
                        <span>
                            Screenshot
                        </span>
                    </button>
                    <button
                        class="flex items-center space-x-2 border border-[#d1d5db] rounded-md px-3 py-1 text-sm text-[#374151] hover:bg-[#f3f4f6] transition"
                        type="button">
                        <i class="fas fa-sync-alt">
                        </i>
                        <span>
                            Restart
                        </span>
                    </button>
                </div>
            </header>
            <main class="flex flex-col flex-1 items-center justify-center px-6 py-12 text-center text-[#475569]">
                <img alt="Light purple wrench icon representing CATIA visualization" class="mb-6" height="48"
                    src="{{ url_for('static', filename='images/gears_icon.svg') }}"
                    width="48" />
                <h3 class="text-lg font-semibold mb-2 text-[#475569]">
                    CATIA Visualization
                </h3>
                <p class="mb-8 max-w-xs">
                    CAD model visualizations and operation results will appear here
                </p>
                <div class="grid grid-cols-2 gap-4 max-w-md w-full">
                    <button
                        class="border border-[#d1d5db] rounded-md py-3 text-sm text-[#475569] hover:bg-[#f3f4f6] transition"
                        type="button">
                        Bounding Box
                    </button>
                    <button
                        class="border border-[#d1d5db] rounded-md py-3 text-sm text-[#475569] hover:bg-[#f3f4f6] transition"
                        type="button">
                        Measurements
                    </button>
                    <button
                        class="border border-[#d1d5db] rounded-md py-3 text-sm text-[#475569] hover:bg-[#f3f4f6] transition"
                        type="button">
                        Analysis Results
                    </button>
                    <button
                        class="border border-[#d1d5db] rounded-md py-3 text-sm text-[#475569] hover:bg-[#f3f4f6] transition"
                        type="button">
                        3D Preview
                    </button>
                </div>
            </main>
        </div>
    </div>

    <script src="{{ url_for('static', filename='catia_automation.js') }}"></script>
</body>

</html> -->







<!-- Dynamic code for chat conversation -->
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>
        AI Assistant CATIA Output
    </title>
    <script src="https://cdn.tailwindcss.com">
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css" rel="stylesheet" />


</head>

<body class="bg-[#fdfdf8] text-[#0f3c4b] font-sans">
    <div class="flex flex-col md:flex-row h-screen">

        <div class="flex flex-col w-[40%] border-r border-[#e5e7eb]">
            <header class="flex items-center justify-between px-6 py-4 border-b border-[#e5e7eb]">
                <h1 class="text-2xl font-semibold">
                    AI Assistant
                </h1>
                <button
                    class="text-[#0f3c4b] text-sm border border-[#d1d5db] rounded-md px-3 py-1 hover:bg-[#f3f4f6] transition"
                    type="button" onclick="returnHome()">
                    ← Back to Home
                </button>
            </header>
            <main id="chat-container" class="flex-1 overflow-y-auto px-6 py-4 space-y-6">
           
            </main>
            <form id="chat-form" class="flex items-center border-t border-[#e5e7eb] px-6 py-4">
                <input id="chat-input"
                    class="flex-1 border border-[#d1d5db] rounded-lg px-4 py-3 text-[#4b5563] text-sm placeholder-[#6b7280] focus:outline-none focus:ring-2 focus:ring-[#19707a]"
                    placeholder="Ask me about your CAD model..." type="text" />
                <button
                    class="ml-4 bg-[#19707a] text-white rounded-lg px-6 py-3 text-sm font-medium hover:bg-[#145a63] transition"
                    type="submit">
                    Send
                </button>
            </form>
        </div>

        <div class="flex flex-col w-[60%]">
            <header class="flex items-center justify-between px-6 py-4 border-b border-[#e5e7eb]">
                <h2 class="text-2xl font-semibold">
                    CATIA Output
                </h2>
                <div class="flex space-x-3">
                    <button
                        class="flex items-center space-x-2 border border-[#d1d5db] rounded-md px-3 py-1 text-sm text-[#374151] hover:bg-[#f3f4f6] transition"
                        type="button">
                        <i class="fas fa-camera">
                        </i>
                        <span>
                            Screenshot
                        </span>
                    </button>
                    <button
                        id="refresh-btn"
                        class="flex items-center space-x-2 border border-[#d1d5db] rounded-md px-3 py-1 text-sm text-[#374151] hover:bg-[#f3f4f6] transition"
                        type="button">
                        <i class="fas fa-sync-alt"  id="refresh-icon"></i>
                        <span>Refresh</span>
                    </button>
                </div>
            </header>
            <main class="flex flex-col flex-1 items-center justify-center px-6 py-12 text-center text-[#475569]">
                {% if cad_screenshots  %}
                    <div id="cad-grid" class="grid grid-cols-2 gap-6 max-w-4xl mx-auto p-4">
                    {% for img_path in cad_screenshots %}
                        <div class="text-center cursor-pointer">
                            <img 
                            src="{{ url_for('static', filename=img_path) }}" 
                            alt="{{ img_path }}" 
                            class="w-full h-64 object-contain rounded border border-gray-300 hover:scale-105 transition-transform duration-200"
                            onclick="openModal(this)" 
                            />
                            <div class="mt-2 text-gray-700 text-sm">{{ img_path.split('/')[-1] }}</div>
                        </div>
                    {% endfor %}
                    </div>


                    <!-- Modal Structure -->
                    <!-- <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center hidden z-50">
                        <div class="relative max-w-5xl max-h-[90vh]">
                            <span 
                            class="absolute top-3 right-3 text-white text-3xl cursor-pointer select-none"
                            onclick="closeModal(event)"
                            >&times;</span>
                            <img id="modalImage" class="rounded max-w-full max-h-[90vh] mx-auto block" alt="Full view" />
                            <div id="modalCaption" class="mt-2 text-center text-white text-lg select-text"></div>
                        </div>
                    </div> -->


                    <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center hidden z-50">
                        <div class="relative rounded shadow-lg flex flex-col items-center max-w-3xl w-full p-6">
                            <button class="absolute top-0 right-0 text-gray-900 text-3xl font-bold hover:text-gray-600" style="color: #CDDC39;"
                                onclick="closeModal(event)" aria-label="Close">&times;</button>
                            <div class="flex items-center justify-center w-full h-full">
                                <img id="modalImage" class="rounded max-w-full max-h-[60vh] transition-all duration-200" alt="Full view" />
                            </div>
                            <div id="modalCaption" class="mt-6 text-center text-gray-900 text-lg font-semibold" style="color: #CDDC39;"></div>
                        </div>
                    </div>



                {% else %}
                    <img alt="Light purple wrench icon representing CATIA visualization" class="mb-6" height="48"
                        src="{{ url_for('static', filename='images/gears_icon.svg') }}"
                        width="48" />
                    <h3 class="text-lg font-semibold mb-2 text-[#475569]">
                        CATIA Visualization
                    </h3>
                    <p class="mb-8 max-w-xs">
                        CAD model visualizations and operation results will appear here
                    </p>
                    <div class="grid grid-cols-2 gap-4 max-w-md w-full">
                        <button
                            class="border border-[#d1d5db] rounded-md py-3 text-sm text-[#475569] hover:bg-[#f3f4f6] transition"
                            type="button">
                            Bounding Box
                        </button>
                        <button
                            class="border border-[#d1d5db] rounded-md py-3 text-sm text-[#475569] hover:bg-[#f3f4f6] transition"
                            type="button">
                            Measurements
                        </button>
                        <button
                            class="border border-[#d1d5db] rounded-md py-3 text-sm text-[#475569] hover:bg-[#f3f4f6] transition"
                            type="button">
                            Analysis Results
                        </button>
                        <button
                            class="border border-[#d1d5db] rounded-md py-3 text-sm text-[#475569] hover:bg-[#f3f4f6] transition"
                            type="button">
                            3D Preview
                        </button>
                    </div>
                    {% endif %}
            </main>

        </div>
    </div>

    <script src="{{ url_for('static', filename='catia_automation.js') }}"></script>
    
    <script>
        document.getElementById('refresh-btn').addEventListener('click', function () {
            refreshImages();
        });

        function refreshImages() {
            const refreshBtn = document.getElementById('refresh-btn');
            const refreshIcon = document.getElementById('refresh-icon');
            const cadGrid = document.getElementById('cad-grid');

            // Disable button and add loading state
            refreshBtn.disabled = true;
            refreshIcon.classList.add('fa-spin');

            // Extract filename from existing images (assuming all images are from same folder)
            const existingImages = cadGrid.querySelectorAll('img');
            if (existingImages.length === 0) {
                console.error('No existing images found to determine folder');
                resetButtonState();
                return;
            }

            // Get filename from the first image path
            const firstImageSrc = existingImages[0].getAttribute('src');
            const pathParts = firstImageSrc.split('/');
            const filename = pathParts[pathParts.length - 2]; // Get folder name before image filename

            // Make AJAX request to refresh images
            fetch(`{{ url_for('catia_automation.refresh_images') }}?filename=${encodeURIComponent(filename)}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Cache-Control': 'no-cache'
                }
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateImageGrid(data.images);
                    } else {
                        console.error('Error refreshing images:', data.error);
                        alert('Error refreshing images: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Fetch error:', error);
                    alert('Network error occurred while refreshing images');
                })
                .finally(() => {
                    resetButtonState();
                });
        }

        function updateImageGrid(imageList) {
            const cadGrid = document.getElementById('cad-grid');

            // Clear existing images
            cadGrid.innerHTML = '';

            // Add updated images
            imageList.forEach(imagePath => {
                const imageContainer = document.createElement('div');
                imageContainer.className = 'text-center cursor-pointer';

                // Add cache busting parameter to force reload
                const cacheBuster = new Date().getTime();
                const imageUrl = `{{ url_for('static', filename='') }}${imagePath}?v=${cacheBuster}`;

                imageContainer.innerHTML = `
                <img 
                src="${imageUrl}" 
                alt="${imagePath}" 
                class="w-full h-64 object-contain rounded border border-gray-300 hover:scale-105 transition-transform duration-200"
                onclick="openModal(this)" 
                />
                <div class="mt-2 text-gray-700 text-sm">${imagePath.split('/').pop()}</div>
            `;

                cadGrid.appendChild(imageContainer);
            });
        }

        function resetButtonState() {
            const refreshBtn = document.getElementById('refresh-btn');
            const refreshIcon = document.getElementById('refresh-icon');

            refreshBtn.disabled = false;
            refreshIcon.classList.remove('fa-spin');
        }
    </script>
</body>

</html>